<div class="container mt-4">
  <h2 class="text-center">Danh s√°ch khuy·∫øn m√£i</h2>

  <!-- üîç T√¨m ki·∫øm & L·ªçc -->
  <div class="row mb-3">
    <div class="col-md-4">
      <input type="text" class="form-control" [(ngModel)]="searchMakm" placeholder="Nh·∫≠p m√£ khuy·∫øn m√£i">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary" (click)="searchKhuyenMai()">T√¨m ki·∫øm</button>
    </div>
    <div class="col-md-3">
      <input type="date" class="form-control" [(ngModel)]="ngayBatDau">
    </div>
    <div class="col-md-3">
      <input type="date" class="form-control" [(ngModel)]="ngayKetThuc">
    </div>
  </div>
  <button class="btn btn-success mb-3" (click)="filterKhuyenMai()">L·ªçc</button>
  <button class="btn btn-info mb-3" (click)="openModal()">Th√™m khuy·∫øn m√£i</button>

  <!-- üìã B·∫£ng danh s√°ch -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>M√£ KM</th>
          <th>M√¥ T·∫£</th>
          <th>Ph·∫ßn TrƒÉm Gi·∫£m</th>
          <th>Ng√†y B·∫Øt ƒê·∫ßu</th>
          <th>Ng√†y K·∫øt Th√∫c</th>
          <th>ƒêi·ªÅu Ki·ªán</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let km of khuyenMais">
          <td>{{ km.maKM }}</td>
          <td>{{ km.moTa }}</td>
          <td>{{ km.phanTramGiam }}%</td>
          <td>{{ km.ngayBatDau }}</td>
          <td>{{ km.ngayKetThuc }}</td>
          <td>{{ km.dieuKien }}</td>
          <td>
            <button class="btn btn-warning btn-sm" (click)="openModal(true, km)">S·ª≠a</button>
            <button class="btn btn-danger btn-sm" (click)="openDeleteModal(km.makm)">X√≥a</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- üü¢ PH√ÇN TRANG -->
  <nav>
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="getKhuyenMai(currentPage - 1)">Tr∆∞·ªõc</button>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="i === currentPage">
        <button class="page-link" (click)="getKhuyenMai(i)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
        <button class="page-link" (click)="getKhuyenMai(currentPage + 1)">Sau</button>
      </li>
    </ul>
  </nav>
</div>

<!-- üü¢ Modal Th√™m/S·ª≠a -->
<div class="modal fade show d-block" *ngIf="isModalOpen">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditing ? 'S·ª≠a khuy·∫øn m√£i' : 'Th√™m khuy·∫øn m√£i' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">M√£ KM</label>
        <input class="form-control" [(ngModel)]="khuyenMaiForm.makm" [readonly]="isEditing">
        
        <label class="form-label mt-2">M√¥ T·∫£</label>
        <input class="form-control" [(ngModel)]="khuyenMaiForm.moTa">
        
        <label class="form-label mt-2">Ph·∫ßn TrƒÉm Gi·∫£m</label>
        <input type="number" class="form-control" [(ngModel)]="khuyenMaiForm.phanTramGiam">
        
        <label class="form-label mt-2">Ng√†y B·∫Øt ƒê·∫ßu</label>
        <input type="date" class="form-control" [(ngModel)]="khuyenMaiForm.ngayBatDau">
        
        <label class="form-label mt-2">Ng√†y K·∫øt Th√∫c</label>
        <input type="date" class="form-control" [(ngModel)]="khuyenMaiForm.ngayKetThuc">
        
        <label class="form-label mt-2">ƒêi·ªÅu Ki·ªán</label>
        <input class="form-control" [(ngModel)]="khuyenMaiForm.dieuKien">
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" (click)="saveKhuyenMai()">L∆∞u</button>
        <button class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
      </div>
    </div>
  </div>
</div>

<!-- üî¥ Modal X√≥a -->
<div class="modal fade show d-block" *ngIf="isDeleteModalOpen">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">X√°c nh·∫≠n x√≥a</h5>
        <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a khuy·∫øn m√£i n√†y kh√¥ng?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" (click)="deleteKhuyenMai()">X√≥a</button>
        <button class="btn btn-secondary" (click)="closeDeleteModal()">H·ªßy</button>
      </div>
    </div>
  </div>
</div>
